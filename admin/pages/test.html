<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Faculty Attendance Report</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <h2>Faculty Attendance Report Demo</h2>
  <button onclick="generateFacultyAttendanceReport()">Generate PDF</button>

  <!-- Hidden Canvas for Chart -->
  <canvas id="attendanceChart" width="200" height="200" style="display: none;"></canvas>

  <script>
    async function generateFacultyAttendanceReport() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();

        doc.setFontSize(16);
        doc.text("Quezon City University", 105, 15, { align: "center" });
        doc.setFontSize(14);
        doc.text("Faculty Attendance Report", 105, 23, { align: "center" });

        doc.setFontSize(11);
        doc.text(`Date Range: March 1 â€“ March 15, 2025`, 14, 35);
        doc.text(`Generated: ${new Date().toLocaleDateString()}`, 14, 42);
        doc.text(`Generated By: Admin User`, 14, 49);

        doc.setFontSize(12);
        doc.text("Faculty Information", 14, 60);
        doc.setFontSize(10);
        doc.text("Name: Prof. Juan Dela Cruz", 14, 68);
        doc.text("RFID No: 123456789", 14, 74);
        doc.text("Department: Computer Studies", 14, 80);
        doc.text("Email: juan.delacruz@qcu.edu.ph", 14, 86);

        doc.setFontSize(12);
        doc.text("Attendance Summary", 14, 98);
        doc.setFontSize(10);
        doc.text("Total Working Days: 10", 14, 106);
        doc.text("Present: 7", 14, 112);
        doc.text("Late: 2", 14, 118);
        doc.text("Absent: 1", 14, 124);
        doc.text("Attendance %: 90%", 14, 130);

        // Draw Pie Chart using Chart.js
        const chartCanvas = document.getElementById("attendanceChart");
        const ctx = chartCanvas.getContext("2d");

        const chart = new Chart(ctx, {
            type: "pie",
            data: {
                labels: ["Present", "Late", "Absent"],
                datasets: [{
                    data: [7, 2, 1],
                    backgroundColor: ["#46DB5D", "#FFC107", "#FF3D3D"]
                }]
            },
            options: {
                responsive: false,
                plugins: { legend: { display: false } }
            }
        });

        await new Promise(resolve => setTimeout(resolve, 1000)); // Wait for chart

        const chartImg = chartCanvas.toDataURL("image/png");
        doc.addImage(chartImg, "PNG", 130, 98, 60, 60);

        const attendanceRows = [
            ["2025-03-01", "Monday", "08:00 AM", "10:00 AM", "Lecture", "Present", "IT-101", "BSIT 4A"],
            ["2025-03-02", "Tuesday", "08:10 AM", "10:00 AM", "Lecture", "Late", "IT-102", "BSIT 4A"],
            ["2025-03-03", "Wednesday", "-", "-", "Lecture", "Absent", "IT-101", "BSIT 4A"],
            ["2025-03-04", "Thursday", "08:00 AM", "10:00 AM", "Lecture", "Present", "IT-101", "BSIT 4A"]
        ];

        doc.autoTable({
            startY: 160,
            head: [["Date", "Day", "Time In", "Time Out", "Type", "Status", "Room", "Section"]],
            body: attendanceRows,
            styles: { fontSize: 9 },
            didParseCell: function (data) {
                if (data.section === 'body' && data.column.index === 5) {
                    const status = data.cell.raw;
                    if (status === "Present") data.cell.styles.fillColor = [70, 219, 93];
                    else if (status === "Late") data.cell.styles.fillColor = [255, 193, 7];
                    else if (status === "Absent") data.cell.styles.fillColor = [255, 61, 61];
                }
            }
        });

        let remarksY = doc.lastAutoTable.finalY + 10;
        doc.setFontSize(11);
        doc.text("Remarks:", 14, remarksY);
        doc.setFontSize(10);
        doc.text("- Faculty was late on March 2 (8:10 AM)", 20, remarksY + 6);
        doc.text("- Absent on March 3 due to seminar", 20, remarksY + 12);

        doc.text("_________________________", 14, 280);
        doc.text("Program Chair", 14, 286);

        doc.setFontSize(9);
        doc.text(`Page 1 of 1`, 180, 290);

        doc.save("Faculty_Attendance_Report.pdf");
    }
  </script>
</body>
</html>
